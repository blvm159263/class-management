stages:
  - build
  - test
  - deploy

build:
  stage: build
  image: maven:3.8.4-openjdk-17
  script:
    - mvn clean package
  artifacts:
    paths:
      - target/MockProject-0.0.1-SNAPSHOT.jar

test:
  stage: test
  image: maven:3.8.4-openjdk-17
  script:
    - mvn test

deploy:
  stage: deploy
  image: mcr.microsoft.com/azure-cli:latest
  script:
    - az login --service-principal -u $AZURE_WA_USERNAME -p $AZURE_WA_PASSWORD --tenant $AZURE_SP_TENANT_ID
    - az webapp deployment source config-zip --resource-group Test --name freshclassmanagement --src target/MockProject-0.0.1-SNAPSHOT.jar